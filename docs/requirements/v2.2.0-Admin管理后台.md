# Admin 管理后台 需求文档

**版本**: v2.2.0
**创建日期**: 2026-02-14
**状态**: 开发中

## 需求背景

ImgVault v2.1.0 已完成图片上传/存储/查询/处理等核心能力，并提供了用户端前端页面（`/imgvault/`）。现需要建设管理后台，为系统管理员提供图片资源管理、审核、统计分析和系统监控能力。

### 调研参考

| 参考项目 | Stars | 主要特点 |
|---------|-------|---------|
| Immich | 92K+ | 用户管理、存储配额、服务器统计、系统设置 |
| Lychee | 4K+ | 相册管理、分享权限、轻量级界面 |
| Cloudinary | 商业 | 图片审核队列、AI 标签、使用分析、资产面板 |

### 设计原则

1. **轻量级** - 纯 HTML/CSS/JS，无需构建工具，与现有前端风格统一
2. **复用 API** - 管理后台通过 `imgvault-api` 已有的 `/api/v1/admin/*` 端点 + 扩展
3. **数据可视** - Dashboard 提供图片数量、存储空间、格式分布等关键指标
4. **操作可追溯** - 所有管理操作记录操作日志

## 需求目标

建设一个完整的 Admin 管理后台，路径为 `/imgvault/admin/`，提供以下能力：

- Dashboard 数据看板（图片统计、存储空间、格式分布）
- 图片资源管理（全状态浏览、搜索、审核、批量操作）
- 回收站管理（查看已删除图片、恢复、永久删除）
- 标签管理（CRUD、关联统计）
- 相册管理（CRUD、封面、关联图片）
- 操作日志查看
- 系统状态监控（健康检查、缓存、服务信息）

## 功能需求

### P0 - 核心功能

| ID | 功能 | 说明 | API 状态 |
|----|------|------|---------|
| A01 | Dashboard 看板 | 图片总数、存储空间、格式分布图、今日上传、最近操作 | 需增强 `/admin/stats` |
| A02 | 图片管理列表 | 全状态图片浏览，支持按状态/格式筛选 | 需修复 `ImageQueryRequest` 增加 status |
| A03 | 图片详情查看 | 弹窗查看图片详情、元数据、标签、操作历史 | 已有 |
| A04 | 批量操作 | 批量删除、批量打标签 | 需完善 batch-tag |
| A05 | 回收站 | 查看已删除图片、恢复、永久删除 | 需修复：增加 status 查询 + restore |

### P1 - 重要功能

| ID | 功能 | 说明 | API 状态 |
|----|------|------|---------|
| A06 | 标签管理 | 标签 CRUD、查看关联图片数 | 已有 `/api/v1/tags` |
| A07 | 相册管理 | 相册 CRUD、封面设置、图片管理 | 已有 `/api/v1/albums` |
| A08 | 操作日志 | 查看系统操作记录，支持按目标筛选 | 已有 |
| A09 | 系统监控 | 健康检查状态、缓存统计、服务信息 | 已有 `/actuator/health` |

### P2 - 锦上添花

| ID | 功能 | 说明 |
|----|------|------|
| A10 | 图片预览 Lightbox | 在管理列表中点击查看大图 |
| A11 | 导出统计报告 | CSV 导出操作日志 |
| A12 | 深色模式 | 管理后台深色/浅色主题切换 |

## 技术方案

### 架构决策

- **前端**: 纯 HTML + CSS + Vanilla JS（与用户前端一致），部署在 `/work-space/ImgVault/frontend/admin/`
- **后端**: 复用 `imgvault-api` 的 `AdminController`，修复并增强现有 API
- **路由**: 通过 nginx `/imgvault/admin/` 提供静态文件，API 复用 `/imgvault/api/v1/admin/*`
- **无需独立服务**: `imgvault-admin` 模块暂不使用，Admin 能力由 `imgvault-api` 统一承载

### 后端 API 修改

#### 1. `ImageQueryRequest` 增加 status 字段
```java
@Schema(description = "状态过滤: 0-删除 1-正常 2-审核中")
private Integer status;

@Schema(description = "关键词搜索(文件名)")
private String keyword;
```

#### 2. `ImageAppService.listImages` 支持 status 参数
- 默认 `status=1`（正常），回收站传 `status=0`
- 管理后台可传 `null` 查所有状态

#### 3. 完善 `/admin/stats` 返回更丰富的统计
```json
{
  "totalImages": 1234,
  "totalStorage": 5368709120,
  "todayUploads": 15,
  "formatDistribution": {"jpeg": 500, "png": 300, "webp": 200},
  "statusDistribution": {"normal": 1100, "deleted": 100, "reviewing": 34},
  "recentUploads": [...],
  "asyncTasks": {...},
  "totalLogs": 5000
}
```

#### 4. 实现回收站恢复 `POST /admin/trash/{id}/restore`

#### 5. 实现批量打标签 `POST /admin/batch-tag`

### 前端页面结构

```
frontend/admin/
├── index.html      # 管理后台主页面
├── admin.css       # 管理后台样式
└── admin.js        # 管理后台逻辑
```

### 页面布局

```
┌──────────────────────────────────────┐
│  Header: ImgVault Admin    [退出]    │
├──────────┬───────────────────────────┤
│ Sidebar  │ Content Area              │
│          │                           │
│ 📊 看板   │ ┌─────┐ ┌─────┐ ┌─────┐  │
│ 🖼 图片   │ │总量  │ │存储 │ │今日 │  │
│ 🗑 回收站 │ │1234  │ │5.0G │ │ 15  │  │
│ 🏷 标签   │ └─────┘ └─────┘ └─────┘  │
│ 📁 相册   │                           │
│ 📋 日志   │ [图表/表格/卡片]          │
│ 🔧 系统   │                           │
│          │ [分页器]                   │
├──────────┴───────────────────────────┤
│  Footer: ImgVault v2.2.0            │
└──────────────────────────────────────┘
```

## UI 设计规范

- 主色调: `#0071e3` (Apple Blue)，与用户前端一致
- 管理后台额外使用: 左侧深色侧边栏 `#1d1d1f`
- 字体: SF Pro / -apple-system
- 圆角: 12px (卡片) / 8px (按钮)
- 阴影: 轻柔 box-shadow

## 验收标准

- [x] Dashboard 看板正确显示统计数据
- [x] 图片管理支持按状态/格式筛选
- [x] 回收站功能完整（查看/恢复/永久删除）
- [x] 批量操作正常工作
- [x] 标签、相册管理页面可用
- [x] 操作日志可查看
- [x] 系统健康状态可查看
- [x] 通过 `https://www.meczyc6.info/imgvault/admin/` 可访问

---

**最后更新**: 2026-02-14
