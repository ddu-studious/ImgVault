<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Demo 2: 对齐排列 (Justified Gallery)</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display',sans-serif;background:#1a1a1c;color:#f5f5f7;min-height:100vh}
.topbar{height:48px;display:flex;align-items:center;justify-content:space-between;padding:0 24px;background:rgba(44,44,46,.72);backdrop-filter:blur(20px);position:sticky;top:0;z-index:10;border-bottom:1px solid rgba(255,255,255,.06)}
.topbar a{color:#2997ff;text-decoration:none;font-size:13px}
.topbar span{font-size:14px;font-weight:600}
.gallery{padding:12px}
.row{display:flex;gap:4px;margin-bottom:4px}
.item{position:relative;overflow:hidden;border-radius:4px;cursor:pointer}
.item img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .3s}
.item:hover img{transform:scale(1.05)}
.item .overlay{position:absolute;inset:0;background:linear-gradient(transparent 50%,rgba(0,0,0,.7));opacity:0;transition:opacity .3s;display:flex;align-items:flex-end;padding:10px}
.item:hover .overlay{opacity:1}
.overlay span{font-size:11px;color:#fff;font-weight:500}
.loading{text-align:center;padding:60px;color:#86868b}
</style>
</head>
<body>
<div class="topbar"><a href="index.html">&larr; 返回列表</a><span>Demo 2: 对齐排列</span><span></span></div>
<div class="gallery" id="g"><div class="loading">加载中...</div></div>
<script>
function px(u){if(!u)return'';const c=u.split('?')[0];if(c.includes('/imgvault/storage/')||c.includes('/imgvault/imgproxy/'))return c;const m1=c.match(/https?:\/\/[^/]+:8081\/(.+)/);if(m1)return'/imgvault/imgproxy/'+m1[1];const m2=c.match(/https?:\/\/[^/]+\/imgvault\/(.+)/);if(m2)return'/imgvault/storage/'+m2[1];return u;}
async function init(){
    const r=await fetch('/imgvault/api/v1/images?page=1&size=30').then(r=>r.json());
    if(r.code!==200)return;
    const imgs=r.data.records;
    const ROW_H=220,GAP=4;
    let html='',i=0;
    while(i<imgs.length){
        let rowW=0,row=[];
        while(i<imgs.length){
            const im=imgs[i],ar=(im.width||300)/(im.height||200);
            const w=ROW_H*ar;
            if(rowW>0&&rowW+w+GAP>window.innerWidth-24){break;}
            row.push({...im,ar,w});
            rowW+=w+GAP;
            i++;
        }
        const totalAR=row.reduce((s,r)=>s+r.ar,0);
        const h=Math.min(ROW_H,(window.innerWidth-24-(row.length-1)*GAP)/totalAR);
        html+='<div class="row">'+row.map(im=>{
            const src=px((im.thumbnails&&im.thumbnails.medium)||im.downloadUrl);
            const itemW=h*im.ar;
            return`<div class="item" style="width:${itemW}px;height:${h}px"><img src="${src}" loading="lazy"><div class="overlay"><span>${im.originalName||''}</span></div></div>`;
        }).join('')+'</div>';
    }
    document.getElementById('g').innerHTML=html;
}
init();
window.addEventListener('resize',()=>{clearTimeout(window._rt);window._rt=setTimeout(init,200);});
</script>
</body>
</html>
